# Архитектура приложения "Родословное дерево"

## Обзор
Полноценное веб-приложение для создания и управления родословными деревьями с современным минималистичным дизайном.

## Технический стек

### Фронтенд
- **React 18** - основной фреймворк
- **Tailwind CSS** - стилизация
- **React Query (TanStack Query)** - управление состоянием и API запросами
- **React Flow** - для создания интерактивных диаграмм дерева
- **html2canvas** - экспорт в изображения
- **React Hook Form** - управление формами
- **Lucide React** - иконки

### Бэкенд
- **Flask** - веб-фреймворк
- **SQLAlchemy** - ORM для работы с БД
- **SQLite** - база данных
- **Flask-JWT-Extended** - JWT авторизация
- **Flask-CORS** - поддержка CORS
- **Werkzeug** - утилиты для Flask

### Контейнеризация
- **Docker** - контейнеризация
- **Docker Compose** - оркестрация контейнеров

## Архитектура системы

### Модели данных

#### User (Пользователь)
```python
{
    "id": int,
    "username": str,
    "email": str,
    "password_hash": str,
    "created_at": datetime,
    "trees": [Tree]
}
```

#### Tree (Дерево)
```python
{
    "id": int,
    "name": str,
    "user_id": int (nullable для анонимных),
    "data": json,  # структура дерева
    "background_image": str,
    "created_at": datetime,
    "updated_at": datetime
}
```

#### Person (Узел дерева)
```python
{
    "id": str,
    "name": str,
    "birth_year": int (optional),
    "death_year": int (optional),
    "gender": str,
    "position": {"x": float, "y": float},
    "parents": [str],  # ID родителей
    "children": [str]  # ID детей
}
```

### API Endpoints

#### Авторизация
- `POST /api/auth/register` - регистрация
- `POST /api/auth/login` - вход
- `POST /api/auth/refresh` - обновление токена
- `GET /api/auth/me` - информация о пользователе

#### Деревья
- `GET /api/trees` - список деревьев пользователя
- `POST /api/trees` - создание дерева
- `GET /api/trees/{id}` - получение дерева
- `PUT /api/trees/{id}` - обновление дерева
- `DELETE /api/trees/{id}` - удаление дерева
- `POST /api/trees/anonymous` - создание анонимного дерева

#### Экспорт
- `POST /api/export/image` - экспорт дерева в изображение

### Компоненты фронтенда

#### Основные страницы
- `HomePage` - главная страница
- `LoginPage` - страница входа
- `RegisterPage` - страница регистрации
- `TreeEditorPage` - редактор дерева
- `DashboardPage` - личный кабинет

#### Компоненты дерева
- `TreeCanvas` - основной холст для дерева
- `PersonNode` - узел человека
- `ConnectionLine` - связь между узлами
- `AddPersonModal` - модальное окно добавления человека
- `ExportModal` - модальное окно экспорта

#### UI компоненты
- `Header` - шапка сайта
- `Sidebar` - боковая панель
- `Button` - кнопка
- `Input` - поле ввода
- `Modal` - модальное окно

## Функциональные требования

### Основные функции
1. **Создание дерева без регистрации** - возможность создать дерево анонимно
2. **Регистрация и авторизация** - система пользователей
3. **Сохранение деревьев** - для зарегистрированных пользователей
4. **Редактирование деревьев** - добавление/удаление/изменение узлов
5. **Экспорт в изображение** - скачивание дерева как картинки
6. **Выбор фона** - настройка фонового изображения

### UX/UI требования
1. **Минималистичный дизайн** - чистый современный интерфейс
2. **Responsive дизайн** - адаптация под мобильные устройства
3. **Drag & Drop** - перетаскивание узлов дерева
4. **Интуитивное управление** - простота использования
5. **Быстрая загрузка** - оптимизация производительности

## Развертывание

### Docker контейнеры
1. **frontend-container** - React приложение (nginx)
2. **backend-container** - Flask API
3. **database** - SQLite файл в volume

### Переменные окружения
- `DATABASE_URL` - путь к базе данных
- `JWT_SECRET_KEY` - секретный ключ для JWT
- `FRONTEND_URL` - URL фронтенда для CORS

## Безопасность
1. **JWT токены** - авторизация через токены
2. **CORS настройки** - ограничение доступа
3. **Валидация данных** - проверка входящих данных
4. **Хеширование паролей** - безопасное хранение паролей

